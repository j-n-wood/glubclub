{{/* Get values from Front Matter, or use defaults */}} {{ $sprite :=
.Params.sprite | default "images/landshark_t.gif" }} {{ $size :=
.Params.sprite_size | default 64 }}

<div
    id="sprite-mover"
    style="
        position: fixed;
        left: 0;
        top: 0;
        pointer-events: none;
        z-index: 9999;
        will-change: transform;
    "
>
    <div
        id="sprite-flipper"
        style="width: {{ $size }}px;
              height: {{ $size }}px;
              background: url('{{ $sprite | relURL }}') no-repeat center;
              background-size: contain;
              transform: translate(-50%, -50%);"
    ></div>
</div>

<script>
    (function () {
        const mover = document.getElementById("sprite-mover");
        const flipper = document.getElementById("sprite-flipper");

        let mouseX = 0,
            mouseY = 0;
        let spriteX = 0,
            spriteY = 0;
        let lastMouseX = 0;
        let currentScale = 1; // Persistent scale state

        const easing = 0.08;
        const offsetX = 25;
        const offsetY = 25;

        window.addEventListener("mousemove", (e) => {
            mouseX = e.clientX;
            mouseY = e.clientY;
        });

        function animate() {
            // 1. Calculate Easing
            spriteX += (mouseX - spriteX) * easing;
            spriteY += (mouseY - spriteY) * easing;

            // 2. Determine Scale (only update if moving significantly)
            // We compare current mouseX to its previous position to detect intent
            const deltaX = mouseX - lastMouseX;
            if (Math.abs(deltaX) > 2) {
                currentScale = deltaX > 0 ? 1 : -1;
            }

            // 3. Apply Transformations
            // Move the container
            mover.style.transform = `translate3d(${spriteX + offsetX}px, ${spriteY + offsetY}px, 0)`;

            // Flip the inner div (centering is handled in CSS transform)
            // We keep the translate(-50%, -50%) here to ensure it flips on center
            flipper.style.transform = `translate(-50%, -50%) scaleX(${currentScale})`;

            lastMouseX = mouseX;
            requestAnimationFrame(animate);
        }

        animate();
    })();
</script>
